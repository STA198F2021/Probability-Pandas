---
title: "Final Report"
subtitle: "due November 16, 2021 by 11:59 PM "
author: "Enzo, Layla, Madeleine"
date: "November 16, 2021"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r load-packages-data, message = FALSE, warning = FALSE}
library(tidyverse)
library(tidymodels)
library(infer)
library(readr)
library(ggplot2)
library(maps)
library(mapdata)
library(sf)
library(plotly)
initial_data <- read_csv("../data/500_Cities.csv")
options(scipen=10000)

usa <- map_data('usa')
state <- map_data("state")

cities <- initial_data %>%
  select(StateAbbr, PlaceName, Population2010, PlaceFIPS, Geolocation, 
         ACCESS2_AdjPrev,CANCER_AdjPrev, CHD_AdjPrev, CHECKUP_AdjPrev,
         COPD_AdjPrev, COLON_SCREEN_AdjPrev,COREM_AdjPrev, COREW_AdjPrev, 
         KIDNEY_AdjPrev, MAMMOUSE_AdjPrev, PAPTEST_AdjPrev) %>%
  rename(state = StateAbbr, city = PlaceName, population = Population2010,
         health_access = ACCESS2_AdjPrev, cancer = CANCER_AdjPrev, 
         heart_disease = CHD_AdjPrev, checkup = CHECKUP_AdjPrev,
         chronic_lung_disease = COPD_AdjPrev, 
         colon_screen = COLON_SCREEN_AdjPrev,
         men_colorectal_cancer_screen = COREM_AdjPrev,
         women_colorectal_cancer_screen = COREW_AdjPrev,
         chronic_kidney_disease = KIDNEY_AdjPrev,
         mammogram = MAMMOUSE_AdjPrev, 
         pap_test = PAPTEST_AdjPrev) %>%
  mutate(large_metro = (population >= 1500000), 
         metro = (population >= 500000 & population < 1500000), 
         med_urban = (population >= 200000 & population < 500000), 
         small_urban = (population >= 50000 & population < 200000)) %>%
  mutate(west = (state %in% c("WA", "OR", "ID", "MT", "WY", "CA", "NV", "UT", 
                              "CO", "AZ", "NM")), 
         midwest = (state %in% c("ND", "SD", "NE", "KS", "MN", "IA", "MO", 
                                 "WI", "IL", "IN", "MI", "OH")),
         northeast = (state %in% c("PA", "NY", "VT", "NH", "MA", "CT", "RI", 
                                   "NJ", "ME")), 
         south = (state %in% c("OK", "TX", "AR", "LA", "MS", "AL", "TN", "KY", 
                               "WV", "VA", "MD", "DE", "NC", "SC", "GA", "FL"))) %>%
  mutate(region = ifelse(west == TRUE, "West", 
                         ifelse(midwest == TRUE, "Midwest", 
                                ifelse(northeast == TRUE, "Northeast", 
                                       ifelse(south == TRUE, 
                                              "South", "NA"))))) %>%
  mutate(city_size = ifelse(large_metro == TRUE, "Large Metropolitan", 
                         ifelse(metro == TRUE, "Metropolitan", 
                                ifelse(med_urban == TRUE, "Medium-Size Urban", 
                                       ifelse(small_urban == TRUE, 
                                              "Small-Size Urban", "NA"))))) %>%
  mutate(checkup_n = (population*(checkup/100)), 
         colon_n_screened = (population*(colon_screen/100)), 
         m_colorectal_n_screened = (population*(men_colorectal_cancer_screen/100)),
         w_colorectal_n_screened = 
           (population*(women_colorectal_cancer_screen/100)),
         mammogram_n_screened = (population*(mammogram/100)),
         pap_n_screened = (population*(pap_test/100))) %>%
  mutate(no_checkup_n = (population - checkup_n), 
         no_colon_n_screened = (population - colon_n_screened), 
         no_m_colorectal_n_screened = (population - m_colorectal_n_screened),
         no_w_colorectal_n_screened = 
           (population - w_colorectal_n_screened),
         no_mammogram_n_screened = (population - mammogram_n_screened),
         no_pap_n_screened = (population - pap_n_screened))

west_cities <- cities %>%
  filter(west)

midwest_cities <- cities %>%
  filter(midwest)

northeast_cities <- cities %>%
  filter(northeast)

south_cities <- cities %>%
  filter(south)
``` 

# Introductory Visualisations of Data Set

```{r Simple-Marginal-Relationship1} 
cities1 <- cities %>%
  na.omit(city_size)
#some rows had NA functions and it made a weird empty column in my ggplot so i got rid of it using above code 
ggplot(cities1, aes(x = city_size, 
                   y = checkup_n, 
                   fill = city_size))+ 
  geom_bar( stat = 'identity')+ 
  labs( x = "City Size", 
        y = "People who got a Checkup",
        title = "Number of Checkups by City Size") +
  theme(axis.text.x = element_text(angle = 45,hjust=1))+ 
  theme(legend.position = "none")
#i did that last theme line bc i wanted to add some color 

#i kinda hate the y-axis numbers here because they are huge --- added options(scipen=10000) to the first code chunk to make this but i think there's a diff way to get rid of scientific notation that i cannot remember atm 
```

```{r Simple-Marginal-Relationship2}
ggplot(cities, aes(x = health_access,
                   y= colon_screen))+
  geom_point()+ 
  labs( x = "Lack of Health Care Access", 
        y = "Number of People who got a Colon Screening",
        title = "Number of Checkups by City Size")
#want to find a way to organize by gender 
```


```{r Predictor-Variable-Distribution}

```


# Multiple Logistic Regression Model for Research Question

```{r Multiple-Logistic-Regression-Model, warning=FALSE}

checkup_fit <- glm(cbind(checkup_n, no_checkup_n) ~ region + 
                     city_size + health_access, 
                   family = binomial, data = cities)
summary(checkup_fit)


colon_fit <- glm(cbind(colon_n_screened, no_colon_n_screened) ~ 
                   region + city_size + health_access, 
    family = binomial, data = cities)
summary(colon_fit)

colon_fit <- glm(cbind(colon_n_screened, no_colon_n_screened) ~ 
                   region + city_size + health_access, 
    family = binomial, data = cities)
summary(colon_fit)


```

# checkup_fit <- logistic_reg() %>%
#   set_engine("glm") %>%
#   fit(as.factor(checkup_n) ~ region + city_size + health_access, data=cities, 
#       family="binomial", exponentiate = TRUE)
# 
# result <- tidy(checkup_fit, conf.int=TRUE)
# print(result)

#can i add interaction variables/predictors to this logistic regression model?


```{r Multiple-Logistic-Regression-Visualisation}



```